<!--
PhotoVault - Professional Photo Management Platform
Copyright (c) 2025 Calmic Sdn Bhd. All rights reserved.

This software is proprietary and confidential. Unauthorized copying, distribution,
modification, or use of this software is strictly prohibited.

Website: https://www.calmic.com.my
Email: support@calmic.com.my

CALMIC SDN BHD - "Committed to Excellence"
-->

<!-- photovault/templates/gallery/photos.html -->
{% extends "base.html" %}
{% block title %}All Photos - PhotoVault{% endblock %}
{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col">
            <h2>My Photos</h2>
            <p class="text-muted">Browse and manage all your photos.</p>
        </div>
        <div class="col-auto">
            <div class="btn-group" role="group">
                <a href="{{ url_for('gallery.photos') }}?filter=all" 
                   class="btn {{ 'btn-primary' if current_filter == 'all' else 'btn-outline-primary' }}">
                    <i class="bi bi-images"></i> All Photos
                </a>
                <a href="{{ url_for('gallery.originals') }}" class="btn btn-outline-secondary">
                    <i class="bi bi-camera"></i> Original Only
                </a>
                <a href="{{ url_for('gallery.edited') }}" class="btn btn-outline-success">
                    <i class="bi bi-pencil"></i> Edited Only
                </a>
            </div>
        </div>
    </div>

    {% if photos and photos.items %}
    <div class="row" id="photoGrid">
        {% for photo in photos.items %}
        <div class="col-md-3 mb-4">
            <div class="card h-100">
                <!-- Display edited image if it exists, otherwise show original -->
                {% if photo.edited_filename %}
                    <img src="{{ url_for('static', filename='uploads/' + photo.user_id|string + '/' + photo.edited_filename) }}" 
                         class="card-img-top" 
                         alt="{{ photo.original_name }} (Edited)">
                {% else %}
                    <img src="{{ url_for('static', filename='uploads/' + photo.user_id|string + '/' + photo.filename) }}" 
                         class="card-img-top" 
                         alt="{{ photo.original_name }}">
                {% endif %}
                
                <div class="card-body d-flex flex-column">
                    <p class="card-text small flex-grow-1">{{ photo.original_name }}</p>
                    
                    <div class="mb-2">
                        {% if photo.edited_filename %}
                        <span class="badge bg-success">
                            <i class="bi bi-pencil"></i> Edited
                        </span>
                        {% else %}
                        <span class="badge bg-secondary">
                            <i class="bi bi-camera"></i> Original
                        </span>
                        {% endif %}
                        
                        {% if photo.auto_enhanced %}
                        <span class="badge bg-info">
                            <i class="bi bi-magic"></i> Enhanced
                        </span>
                        {% endif %}
                        
                        {% if photo.upload_source == 'camera' %}
                        <span class="badge bg-warning">
                            <i class="bi bi-camera-video"></i> Camera
                        </span>
                        {% endif %}
                    </div>
                    
                    <div class="btn-group btn-group-sm" role="group">
                        <!-- View photo details -->
                        <a href="{{ url_for('gallery.view_photo', photo_id=photo.id) }}" class="btn btn-outline-primary" title="View photo details">
                            <i class="bi bi-eye"></i>
                        </a>
                        <!-- Edit/Markup photo -->
                        <a href="{{ url_for('main.editor', photo_id=photo.id) }}" class="btn btn-outline-warning" title="Edit photo">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <!-- Download -->
                        {% if photo.edited_filename %}
                        <a href="{{ url_for('static', filename='uploads/' + photo.user_id|string + '/' + photo.edited_filename) }}" 
                           download="{{ photo.original_name }}_edited" 
                           class="btn btn-outline-success" 
                           title="Download edited version">
                            <i class="bi bi-download"></i>
                        </a>
                        {% else %}
                        <a href="{{ url_for('static', filename='uploads/' + photo.user_id|string + '/' + photo.filename) }}" 
                           download="{{ photo.original_name }}" 
                           class="btn btn-outline-success" 
                           title="Download original">
                            <i class="bi bi-download"></i>
                        </a>
                        {% endif %}
                        <!-- Delete photo -->
                        <button class="btn btn-outline-danger" onclick="deletePhoto({{ photo.id }})" title="Delete photo">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Pagination -->
    {% if photos.pages > 1 %}
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if photos.has_prev %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('gallery.photos', page=photos.prev_num, filter=current_filter) }}">Previous</a>
                </li>
            {% endif %}
            
            {% for page_num in photos.iter_pages() %}
                {% if page_num %}
                    {% if page_num != photos.page %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('gallery.photos', page=page_num, filter=current_filter) }}">{{ page_num }}</a>
                        </li>
                    {% else %}
                        <li class="page-item active">
                            <span class="page-link">{{ page_num }}</span>
                        </li>
                    {% endif %}
                {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">...</span>
                    </li>
                {% endif %}
            {% endfor %}
            
            {% if photos.has_next %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('gallery.photos', page=photos.next_num, filter=current_filter) }}">Next</a>
                </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
    
    {% else %}
    <div class="text-center py-5">
        <i class="bi bi-images fa-4x text-muted mb-3"></i>
        <h4>No photos found</h4>
        {% if current_filter == 'original' %}
            <p class="text-muted">No original photos found. Try viewing all photos or upload some new ones!</p>
        {% elif current_filter == 'edited' %}
            <p class="text-muted">No edited photos found. Start editing your photos to see them here!</p>
        {% else %}
            <p class="text-muted">Start by taking your first photo or uploading some files!</p>
        {% endif %}
        <a href="{{ url_for('main.upload') }}" class="btn btn-primary">
            <i class="bi bi-camera me-2"></i>Get Started
        </a>
    </div>
    {% endif %}
</div>

<script>
function deletePhoto(photoId) {
    if (confirm('Are you sure you want to delete this photo? This action cannot be undone.')) {
        fetch(`/api/photos/${photoId}/delete`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Photo deleted successfully!');
                location.reload();
            } else {
                alert('Error deleting photo: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error deleting photo. Please try again.');
        });
    }
}
</script>
{% endblock %}